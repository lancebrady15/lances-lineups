{
  "hash": "6fb17f5608372e40318ef7b99b679d0b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Blog Post #1: Lineup Protection or Lineup Penalty?\"\nauthor: \"Lance Brady\"\ndate: \"2025-02-18\"\ncategories: [lineup protection, lineups, statcast]\nformat: html\neditor: visual\nimage: blog1.jpg\n---\n\n\n\n## Takeaways\n\n1.  The next batter's xwOBA does have a small but significant impact on the current plate appearance's xwOBA, and this effect is negative. A stronger on-deck hitter results in lower than expected outcomes for that plate appearance.\n2.  Some of the league's best pitchers perform better when a strong hitter is on deck, serving as an indication of mental aptitude or ability to elevate in high-leverage moments that makes them so successful. This suggests that lineup protection may not be a universal phenomenon and that individual pitchers may have different responses to it.\n3.  While we see evidence pointing to fewer walks, more strikeouts, and fewer extra base hits with better `next_batter_xwOBA`, we cannot conclusively point to the next batter's xwOBA as the cause of these effects.\n4.  Even when controlling for batter skill, matchup effects, and game state, a higher next_batter_xwOBA is associated with a small but statistically significant decrease in the current batter’s expected batting average (xBA) for that plate appearance. If the next batter’s xwOBA goes up by 0.100, we estimate a \\~-0.003 reduction in pa_xBA per plate appearance—over 500 plate appearances, that amounts to about 1.5 fewer hits compared to otherwise.\n5.  When we select certain fixed effects, we find that the next batter's xwOBA continue to have a small but significant impact on the current plate appearance's xwOBA, and this effect is negative. A stronger on-deck hitter results in lower than expected outcomes for that plate appearance.\n\n## Introduction to Lineup Protection\n\nBatting order optimization is a heavily studied aspect of baseball decision-making, where teams construct lineups to maximize run production. Most studies in this area assume that hitters in the lineup are independent of one another. However, the concept of lineup protection—the idea that a hitter’s performance is influenced by the quality of the hitter after them—remains debated within the sabermetrics community, most often not believed in by it; it has not been supported by previous statistical studies. Although batting order decisions may offer only marginal advantages in expected runs, in an era where every competitive edge counts, even subtle effects like lineup protection deserve closer examination. The theory behind lineup protection is that a hitter with a good hitter behind them will be harder to pitch around because pitchers won't want to face the guy after him either, particularly with more runners on base. Thus, walks would decrease, and that would mean more fastballs, strikes, and pitches over the plate, essentially increasing the probability for productive hitting, specifically extra-base hits (doubles, triples, and homeruns).\n\nThere are two main ways to study lineup protection:\n\n**Pitcher-Centric Analysis:** Examining how pitchers alter their approach based on the quality next hitter. Previous research using 30 hitter pairs since the advent of Statcast suggested that protected hitters see an average of 0.25% more strikes compared to league average, and 0.07% more pitches down the middle of the zone. This would lead to 6 additional strikes and 2 additional pitches down the middle over a season. This study was extremely limited, however, and did not account for situations without protection, only used 30 pairs of hitters, and only compared the strike percentage a protected hitter received to the league average of that year, not to the strike percentage they had in other non-protected plate appearances. If lineup protection were to exist, teams should avoid wasting lineup protection on free swingers (putting free swingers before \"protectors\") so that the protection is not wasted on hitters who would swing at a higher rate anyway (The Paraball Notes, 2024). Quantitatively, the hitter who bats behind you SHOULD impact the pitches you see, because the run expectancy of certain plays occurring (like walks) would change based on who the following batter is (Weinberg, 2013). Evidence of certain pairs often seems to point to the opposite, with a 2012 evaluation of players hitting after Andrew McCutchen, Ryan Braun, and Joey Votto showing no evidence that pitchers were pitching them differently based on the protection they had (Cameron, 2012).\n\nHall of Famer Miguel Cabrera attributed part of his power struggles early in the 2019 season to a lack of lineup protection, essentially calling out productive-yet-not-spectacular hitter behind him, Niko Goodrum, saying, \"In the past... I got a big bat behind me. You see the way guys pitch me? that explains everything.\" His manager responded by saying his statement was \"crazy.\" Data revealed that he wasn't getting particularly fewer fastballs, strikes, or good pitches to hit in general, and that in his particular case, there wasn't evidence for lineup protection (Stavenhagen, 2019).\n\n**Hitter Outcome Analysis:** Investigating whether the quality of the next hitter influences the current hitter’s performance. Pre-Pitch F/X research found that pitchers who know that a good hitter is up next will \"pitch around\" the current hitter, resulting in significantly more walks, and moderately more strikeouts. However, it found that when it comes to putting the ball in play, there was no significant impact (Tango, 2006). Much of the sabermetric community says that lineup protection is a myth, and that a player's production is almost solely determined by their own skills; luck and random variation also play a small role (Ambrosino, 2011). A 2008 study found that with a small magnitude, the quality of the on-deck hitter negatively impacts the preceding hitter (Bradbury, 2008).\n\nHowever, a study in 2011 using Retrosheet play-by-play data from 2002-2009 MLB seasons found that power numbers did have significant differences in situations of potential lineup protection. This study argues that previous evidence of lineup protection was not uncovered because endogeneity bias introduced by managers selectively choosing their lineups. For a player's own performance, they likely are hitting better than their own season averages when they are near the top of the lineup (they have more protection) because they are already doing well at that time for a number of reasons. A good hitter who, for whatever reason, is hitting poorly will be put at the bottom of the lineup (and have less protection), but likely hit well at that spot, and thus, we would observe better hitting with less protection. Thus, protection and performance numbers become tangled in unobservable ways. While these endogeneity issues are a concern, they seem to work in both directions, and with a robust enough dataset, we should be able to see the effects of lineup protection, if it is a real phenomenon.\n\nUsing injuries to a batter’s “protector” as a quasi-random natural experiment, this study finds that batters who have stronger protection (i.e., a higher OPS hitter behind them) produce significantly more power. Specifically, a 100-point increase in the protector’s OPS correlates with a 9.7% rise in extra-base hits, and the effect is especially pronounced for third hitters (a 26% increase). The results also suggest that when left unprotected, batters draw more walks—particularly intentional walks, as previous literature has supported (Phillips, 2011). It also found that hits in general remained unchanged with protection or not, suggesting that batters are not simply putting the ball into play fewer times, but having less powerful, and thus, productive, contact. However, this study simply made claims about the distribution of outcomes and not about overall offensive production. Protected hitters got fewer walks and more extra-base hits, which act in opposing manners. Our study will use Expected Weighted On-Base Average, an offensive statistic that correlates directly with a player's overall contribution to run production from the plate, to tackle this gap in research.\n\nWe will also use a large sample size of over 3 million plate appearances from 2015-2024 to ensure that our results are robust.\n\nMost other previous literature of hitter outcome analysis has been rather anecdotal, focusing on specific players and how they fare with protection. Using over 3000 Plate Appearances from Pete Alonso's career before his 2024 season, we can see higher slugging percentages with better hitters behind him, along with being 11% more likely to homer. With worse protection, he is more likely to walk, although his strikeout rates go against previous research and actually decrease with poor hitters behind him (Britton, 2024). Other research takes specific teams and analyzes whether the topic of lineup protection even applies and whether it serves a purpose in that roster's decision-making. When the Diamondbacks acquired Mark Trumbo in 2014, writers brought up the fact that even though Trumbo's power threat could serve to protect Paul Goldschmidt, Trumbo may not even be much better than other Diamondbacks hitters who could replace him in terms of offensive threat in general (Wiser, 2014). In 2015, Billy Hamilton pointed to a different sort of offensive advantage owing to the hitter behind him–knowing Joey Votto was hitting after him, an incredibly selective hitter often with long counts, allowed Hamilton to be patient and wait for the right pitch to steal on. In this situation, with a small sample size, the threat of Votto was preventing opposing pitchers from throwing fastballs with Hamilton on base, allowing Hamilton to get better base-stealing opportunities (Petriello, 2015).\n\nIt is worth noting that many within baseball discuss lineup protection with certainty. Alonso had pushed for J.D. Martinez to join and hit behind him for the Mets in 2024, hoping it would help his offensive statistics. Interviews with several within the game in 2015 resulted in a plethora of answers, from Joe Girardi saying lineup protection was most significant in lefty-righty matchups, Madison Bumgarner saying he doesn't pay attention to the on-deck circle, Tim Hudson saying that it's \"foolish if you don't look at the next hitter,\" and multiple other pitchers saying it is a factor in their decision-making, especially later in the game (Laurila, 2016).\n\nIt is also worth noting that these anecdotal examinations are subject to sample size constraints and extremely limited in their ability to observe lineup protection on a large scale in Major League Baseball. This article aims to tackle that problem.\n\n## Aim\n\nThis article aims to provide further insights into lineup protection using pitch-by-pitch data Statcast data from the 2015 to 2024 Major League Baseball seasons, focusing on analyzing hitter outcomes. While literature is mixed and often negative on the existence of lineup protection, it often uses anecdotal evidence, and a more thorough investigation is necessary, especially one using the more advanced expected statistics we now have available.\n\n## Setup\n\nWe would like our independent variables to be the following:\n\n-   Current pitcher random effects\n\n-   Current hitter's handedness and underlying quality (e.g. xwOBA, xBA)\n\n-   Next hitter's handedness and underlying quality (e.g. xwOBA, xBA)\n\n-   Base-out state\n\n-   Inning\n\n-   Run differential\n\nPrevious studies have looked at protection as a binary independent variable, but that is a narrow view on lineup protection. Lineup protection must be considered as a continuous variable because some players will protect more than others.\n\nOur outcome variable for our first model will be that plate appearance's xwOBA, which will essentially give us the quality of that plate appearance based on the independent variables. We would then like to see what factor the quality of the next batter has in the outcome.\n\nWe will use a mixed-effects linear model to account for the random effects of pitchers and batters. Our models are described in detail below.\n\n## Methods\n\nFor full methods and model outputs [view the full appendix here](../../appendix/blog1-appendix.qmd).\n\n## Model #1: Mixed Effects Linear Model of Plate Appearances\n\n### I. Overall Offensive Value: wOBA and xWOBA\n\nFirst, let's look at residuals from season-long averages for each plate appearance. We will read in our libraries and data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Matrix\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(lmerTest)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'lmerTest'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:lme4':\n\n    lmer\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:stats':\n\n    step\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ tidyr::expand() masks Matrix::expand()\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n✖ tidyr::pack()   masks Matrix::pack()\n✖ tidyr::unpack() masks Matrix::unpack()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(pubtheme)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: plotly\n\nAttaching package: 'plotly'\n\nThe following object is masked from 'package:ggplot2':\n\n    last_plot\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nThe following object is masked from 'package:graphics':\n\n    layout\n\nLoading required package: scales\n\nAttaching package: 'scales'\n\nThe following object is masked from 'package:purrr':\n\n    discard\n\nThe following object is masked from 'package:readr':\n\n    col_factor\n\nLoading required package: ggrepel\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(purrr)\n\npa_data_final = readRDS(\"data/pa_data_final.rds\")\n```\n:::\n\n\n\nOur first model will be a mixed-effects linear model of plate appearances, where we will use the xwOBA of the current plate appearance as our outcome variable. We will use the xwOBA of the current and next batters as our main independent fixed effect, and we will also include the batter's handedness matchup, the next batter's handedness matchup, the baserunner state, outs when up, run differential, and game year as fixed effects. We will also include random effects for pitcher and batter. Note that the next batter's handedness matchup is the handedness of the next batter with the handedness of the current pitcher, and thus does not account for potential anticipated calls to the bullpen (when a pitcher knows they are coming out after the current batter) or pinch-hitting situations.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_1 <- lmer(\n  pa_xwOBA ~ batter_xwOBA + next_batter_xwOBA + \n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year +\n    (1 | pitcher),\n  data = pa_data_final\n)\n\nsummary(m_protection_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: \npa_xwOBA ~ batter_xwOBA + next_batter_xwOBA + current_matchup_advantage +  \n    next_matchup_advantage + baserunner_state + outs_when_up +  \n    run_diff + game_year + (1 | pitcher)\n   Data: pa_data_final\n\nREML criterion at convergence: 741757.7\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.3711 -0.7738 -0.3856  0.7186  4.7365 \n\nRandom effects:\n Groups   Name        Variance  Std.Dev.\n pitcher  (Intercept) 0.0005167 0.02273 \n Residual             0.1460217 0.38213 \nNumber of obs: 809909, groups:  pitcher, 2358\n\nFixed effects:\n                            Estimate Std. Error         df t value Pr(>|t|)    \n(Intercept)               -6.786e-05  4.986e-03  4.402e+05  -0.014 0.989140    \nbatter_xwOBA               1.020e+00  1.128e-02  8.098e+05  90.401  < 2e-16 ***\nnext_batter_xwOBA         -2.742e-02  1.170e-02  8.097e+05  -2.344 0.019074 *  \ncurrent_matchup_advantage  2.001e-02  9.017e-04  5.310e+05  22.191  < 2e-16 ***\nnext_matchup_advantage     8.058e-04  9.045e-04  4.962e+05   0.891 0.372992    \nbaserunner_state1B         1.595e-03  1.147e-03  8.097e+05   1.390 0.164438    \nbaserunner_state1B-2B      1.960e-03  1.781e-03  8.098e+05   1.100 0.271155    \nbaserunner_state1B-3B      6.192e-03  2.639e-03  8.098e+05   2.346 0.018970 *  \nbaserunner_state2B         7.951e-03  1.612e-03  8.098e+05   4.933 8.10e-07 ***\nbaserunner_state2B-3B      3.182e-03  3.054e-03  8.098e+05   1.042 0.297390    \nbaserunner_state3B         4.995e-03  2.690e-03  8.097e+05   1.857 0.063292 .  \nbaserunner_stateLoaded     1.820e-03  2.937e-03  8.092e+05   0.620 0.535527    \nouts_when_up              -4.443e-03  5.360e-04  8.096e+05  -8.288  < 2e-16 ***\nrun_diff                   6.541e-04  1.435e-04  5.644e+05   4.559 5.15e-06 ***\ngame_year2016              2.664e-03  1.800e-03  3.502e+05   1.480 0.138963    \ngame_year2017              3.513e-03  1.872e-03  2.067e+05   1.877 0.060501 .  \ngame_year2018              3.275e-03  1.904e-03  1.401e+05   1.721 0.085344 .  \ngame_year2019              7.899e-03  1.996e-03  1.154e+05   3.958 7.57e-05 ***\ngame_year2020              2.297e-03  3.233e-03  3.128e+05   0.710 0.477489    \ngame_year2021              6.133e-03  2.001e-03  6.650e+04   3.064 0.002183 ** \ngame_year2022              6.765e-03  2.009e-03  5.118e+04   3.367 0.000760 ***\ngame_year2023              7.512e-03  1.994e-03  3.849e+04   3.768 0.000165 ***\ngame_year2024              6.872e-03  2.039e-03  3.030e+04   3.371 0.000751 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCorrelation matrix not shown by default, as p = 23 > 12.\nUse print(x, correlation=TRUE)  or\n    vcov(x)        if you need it\n```\n\n\n:::\n:::\n\n\n\nOne piece of verifying evidence for our model is that the coefficient of `batter_xwOBA` is about 1 (it is 1.02), as we are predicting the xwOBA of a player's plate appearance using their average xwOBA from the year. It is also verifying that our `current_matchup_advantage` is positive and signficant, with a coefficient of 0.02, indicating that the batter's handedness matchup advantage does have a positive impact on the xwOBA of the current plate appearance.\n\nWhen accounting for all of the other variables, we can see that the coefficient of `next_batter_xwOBA` is negative, at -0.02742, and signficant at the $\\alpha$ = 0.05 level, with a p-value of 0.02.\n\nThis coefficient means that with a 0.100 increase in the next batter's xwOBA, we would expect a 0.0027 decrease in the current plate appearance's xwOBA. This is a small effect, but it is statistically significant and suggests that a reverse lineup protection, or a lineup penalty does exist to some degree when a better hitter is on deck.\n\nWe do not find that a matchup advantage on deck has a significant impact on the current plate appearance's xwOBA, with a coefficient of 0.0008 and a p-value of 0.37.\n\nWhile we will want to use model selection techniques to check if all of these variables are important, other signficant coefficients make sense. The only two `baserunner_state` with a singificant coefficient is when a runner is on 2B, with a positive coefficient of 0.008, or 1B and 3B, with a postivie coefficient of 0.006 indicating that having a runner on 2B or 1B-3B increases the xwOBA of the current plate appearance. The `outs_when_up` variable has a negative and signficiant coefficient, indicating that having more outs when up decreases the xwOBA of the current plate appearance. The `run_diff` variable has a positive and significant coefficient, indicating that having a larger run differential increases the xwOBA of the current plate appearance. This could indicate that when teams are up by a lot, they tend to be facing weaker pitchers, or have a confidence that helps them at the plate. Overall, this effect is incredibly small. `game_year` also makes sense, as the most signficant positive coefficeints in years 2019, 2021, 2022, 2023, and 2024 were all years with higher run scoring environments than the reference level of 2015.\n\nLet's check this model with a mixed-effects linear model of plate appearances, where we will use the xwOBA difference of the current plate appearance from the batter's season long average as the outcome variable. We will use the xwOBA of the next batter as our main independent variable, and we will also include the batter's handedness, the next batter's handedness, the baserunner state, outs when up, run differential, and game year as fixed effects. We will also include random effects for pitcher.\n\nIt is worth noting that initially we got a singularity with regards to the random effect `(1 | batter)` when it was included. This indicated that the model already had the effect of the batter baked into the model through the `xwOBA_diff` outcome variable, which is derived from `pa_xwOBA` and `batter_xwOBA`. So, we knew that almost all of the variance between batters can be accounted for by their season-long `batter_xwOBA`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_2 <- lmer(\n  xwOBA_diff ~ next_batter_xwOBA + \n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year +\n    (1 | pitcher),\n  data = pa_data_final\n)\n\nsummary(m_protection_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: xwOBA_diff ~ next_batter_xwOBA + current_matchup_advantage +  \n    next_matchup_advantage + baserunner_state + outs_when_up +  \n    run_diff + game_year + (1 | pitcher)\n   Data: pa_data_final\n\nREML criterion at convergence: 741753.7\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.3634 -0.7742 -0.3862  0.7195  4.7311 \n\nRandom effects:\n Groups   Name        Variance  Std.Dev.\n pitcher  (Intercept) 0.0005166 0.02273 \n Residual             0.1460221 0.38213 \nNumber of obs: 809909, groups:  pitcher, 2358\n\nFixed effects:\n                            Estimate Std. Error         df t value Pr(>|t|)    \n(Intercept)                4.685e-03  4.192e-03  3.107e+05   1.118 0.263711    \nnext_batter_xwOBA         -2.224e-02  1.132e-02  8.099e+05  -1.964 0.049480 *  \ncurrent_matchup_advantage  1.995e-02  9.010e-04  5.317e+05  22.139  < 2e-16 ***\nnext_matchup_advantage     7.917e-04  9.044e-04  4.965e+05   0.875 0.381370    \nbaserunner_state1B         1.633e-03  1.147e-03  8.097e+05   1.423 0.154655    \nbaserunner_state1B-2B      1.990e-03  1.781e-03  8.098e+05   1.117 0.263913    \nbaserunner_state1B-3B      6.218e-03  2.639e-03  8.098e+05   2.356 0.018474 *  \nbaserunner_state2B         7.969e-03  1.612e-03  8.098e+05   4.944 7.65e-07 ***\nbaserunner_state2B-3B      3.147e-03  3.054e-03  8.098e+05   1.031 0.302774    \nbaserunner_state3B         5.007e-03  2.690e-03  8.097e+05   1.862 0.062659 .  \nbaserunner_stateLoaded     1.806e-03  2.937e-03  8.092e+05   0.615 0.538656    \nouts_when_up              -4.439e-03  5.360e-04  8.096e+05  -8.281  < 2e-16 ***\nrun_diff                   6.577e-04  1.435e-04  5.646e+05   4.584 4.56e-06 ***\ngame_year2016              2.747e-03  1.800e-03  3.498e+05   1.526 0.126944    \ngame_year2017              3.649e-03  1.870e-03  2.062e+05   1.951 0.051045 .  \ngame_year2018              3.350e-03  1.903e-03  1.399e+05   1.761 0.078324 .  \ngame_year2019              8.099e-03  1.992e-03  1.147e+05   4.065 4.81e-05 ***\ngame_year2020              2.576e-03  3.229e-03  3.116e+05   0.798 0.425082    \ngame_year2021              6.297e-03  1.999e-03  6.616e+04   3.150 0.001636 ** \ngame_year2022              6.727e-03  2.009e-03  5.118e+04   3.348 0.000814 ***\ngame_year2023              7.618e-03  1.993e-03  3.839e+04   3.823 0.000132 ***\ngame_year2024              6.869e-03  2.039e-03  3.030e+04   3.369 0.000755 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCorrelation matrix not shown by default, as p = 22 > 12.\nUse print(x, correlation=TRUE)  or\n    vcov(x)        if you need it\n```\n\n\n:::\n:::\n\n\n\nCoefficients of this model mirror those of the previous model in both signficance and direction, but our `next_batter_xwOBA` coefficient has decreased in magnitude to -0.02224, and is still signficant at the $\\alpha$ = 0.05 level, with a p-value of 0.05. This further supports our evidence that the next batter's xwOBA does have a small but significant impact on the current plate appearance's xwOBA, and that this effect is negative.\n\nFor interpretability, we will go back to predicting `pa_xwOBA` in our next model, as it is a more intuitive metric to understand than the difference from the batter's season-long average.\n\n**Takeaway:** The next batter's xwOBA does have a small but significant impact on the current plate appearance's xwOBA, and this effect is negative. A stronger on-deck hitter results in lower than expected outcomes for that plate appearance.\n\nIf we now want to incorporate how different hitters and pitchers are affected by the next batter, we can add a slope for the next batter's xwOBA as a random effect. This will allow us to see how the effect of the next batter's xwOBA varies by pitcher. We do not expect an equivalent effect with batters, as players describe how the pitcher will act differently based on the abilities of the next batter, not the batter. To make sure there is enough data to get a good estimate of the slope, we will only include pitchers with at least 100 plate appearances in our dataset for a given year. We will treat the slope and intercept independently, as we do not expect that pitchers who allow higher/lower overall xwOBA also respond differently to lineup protection.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count number of plate appearances per pitcher per year\npitcher_counts <- pa_data_final %>%\n  group_by(pitcher, game_year) %>%\n  summarize(n_pa = n(), .groups = \"drop\") %>%\n  filter(n_pa >= 100) \n\n# Filter dataset to just those pitchers\npa_filtered <- pa_data_final %>%\n  mutate(pitcher_year = interaction(pitcher, game_year)) %>%\n  filter(pitcher_year %in% interaction(pitcher_counts$pitcher, pitcher_counts$game_year))\n```\n:::\n\n\n\nLet's run our model using `pa_filtered`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_slope <- lmer(\n  pa_xwOBA ~ batter_xwOBA + next_batter_xwOBA +\n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year +\n    (1 + next_batter_xwOBA || pitcher_year),  # uncorrelated random effects\n  data = pa_filtered\n)\n\nsummary(m_protection_slope)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: \npa_xwOBA ~ batter_xwOBA + next_batter_xwOBA + current_matchup_advantage +  \n    next_matchup_advantage + baserunner_state + outs_when_up +  \n    run_diff + game_year + (1 + next_batter_xwOBA || pitcher_year)\n   Data: pa_filtered\n\nREML criterion at convergence: 565997.2\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.3677 -0.7696 -0.3876  0.7057  4.7346 \n\nRandom effects:\n Groups         Name              Variance  Std.Dev.\n pitcher_year   (Intercept)       0.0003614 0.01901 \n pitcher_year.1 next_batter_xwOBA 0.0028632 0.05351 \n Residual                         0.1449113 0.38067 \nNumber of obs: 622199, groups:  pitcher_year, 2876\n\nFixed effects:\n                            Estimate Std. Error         df t value Pr(>|t|)    \n(Intercept)               -4.600e-04  5.783e-03  6.510e+04  -0.080 0.936606    \nbatter_xwOBA               1.017e+00  1.283e-02  6.222e+05  79.288  < 2e-16 ***\nnext_batter_xwOBA         -3.152e-02  1.336e-02  1.258e+05  -2.359 0.018346 *  \ncurrent_matchup_advantage  1.944e-02  1.018e-03  3.706e+05  19.093  < 2e-16 ***\nnext_matchup_advantage     8.983e-04  1.019e-03  3.322e+05   0.881 0.378098    \nbaserunner_state1B         1.537e-03  1.304e-03  6.220e+05   1.179 0.238511    \nbaserunner_state1B-2B      9.683e-04  2.078e-03  6.222e+05   0.466 0.641151    \nbaserunner_state1B-3B      2.719e-03  3.080e-03  6.220e+05   0.883 0.377282    \nbaserunner_state2B         6.106e-03  1.843e-03  6.221e+05   3.314 0.000921 ***\nbaserunner_state2B-3B     -1.422e-03  3.559e-03  6.220e+05  -0.399 0.689560    \nbaserunner_state3B         7.113e-03  3.085e-03  6.220e+05   2.305 0.021151 *  \nbaserunner_stateLoaded    -2.722e-03  3.593e-03  6.219e+05  -0.758 0.448645    \nouts_when_up              -4.318e-03  6.092e-04  6.217e+05  -7.087 1.37e-12 ***\nrun_diff                   1.121e-04  1.837e-04  4.468e+05   0.610 0.541649    \ngame_year2016              9.108e-04  2.866e-03  2.200e+03   0.318 0.750657    \ngame_year2017             -1.016e-04  2.911e-03  2.327e+03  -0.035 0.972148    \ngame_year2018             -1.458e-03  2.931e-03  2.290e+03  -0.497 0.618886    \ngame_year2019              2.813e-03  3.100e-03  2.453e+03   0.907 0.364376    \ngame_year2020             -1.089e-02  1.486e-02  4.693e+03  -0.733 0.463727    \ngame_year2021              1.866e-03  3.026e-03  2.450e+03   0.617 0.537514    \ngame_year2022              1.698e-03  2.977e-03  2.303e+03   0.570 0.568543    \ngame_year2023              1.003e-03  2.887e-03  2.376e+03   0.348 0.728162    \ngame_year2024             -1.737e-03  2.937e-03  2.286e+03  -0.591 0.554288    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCorrelation matrix not shown by default, as p = 23 > 12.\nUse print(x, correlation=TRUE)  or\n    vcov(x)        if you need it\n```\n\n\n:::\n:::\n\n\n\nWhile the signficance of `game_year` coefficients have disappeared, the rest of the coefficients are similar to the previous model. The coefficient of `next_batter_xwOBA` is now -0.0315, and is signficant at the $\\alpha$ = 0.05 level, with a p-value of 0.02.\n\n#### IA. Inspection of the Random Effects for xwOBA\n\nIn order to get an indication of whether these random slopes are important and not just a product of random noise, we can look at the random effects of the model. We can do this by looking at the random slopes for the next batter's xwOBA for each pitcher-year combination.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Convert to a dataframe with rownames as a column\nre_df <- ranef(m_protection_slope)$pitcher_year %>%\n  as.data.frame() %>%\n  rownames_to_column(var = \"pitcher_year\")\n\n## Separate into pitcher ID and year\nre_df <- re_df %>%\n  separate(pitcher_year, into = c(\"pitcher\", \"year\"), sep = \"\\\\.\", convert = TRUE)\n\n## Initialize a list to store correlation results\nyoy_results <- list()\n\n## Loop through each year pair and calculate correlations\nyears <- sort(unique(re_df$year))\n\nfor (i in 1:(length(years) - 1)) {\n  y1 <- years[i]\n  y2 <- years[i + 1]\n  \n  df_pair <- re_df %>%\n    filter(year %in% c(y1, y2)) %>%\n    select(pitcher, year, next_batter_xwOBA) %>%\n    pivot_wider(names_from = year, values_from = next_batter_xwOBA, names_prefix = \"xwOBA_\") %>%\n    drop_na()\n  \n  cor_val <- cor(df_pair[[paste0(\"xwOBA_\", y1)]], df_pair[[paste0(\"xwOBA_\", y2)]])\n  \n  yoy_results[[paste0(y1, \"_to_\", y2)]] <- list(\n    from = y1,\n    to = y2,\n    correlation = cor_val,\n    n_shared_pitchers = nrow(df_pair)\n  )\n}\n\n## Print all year-over-year correlations\nyoy_df <- bind_rows(yoy_results, .id = \"year_pair\")\nprint(yoy_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 9 × 5\n  year_pair     from    to correlation n_shared_pitchers\n  <chr>        <int> <int>       <dbl>             <int>\n1 2015_to_2016  2015  2016       0.396               221\n2 2016_to_2017  2016  2017       0.374               220\n3 2017_to_2018  2017  2018       0.367               200\n4 2018_to_2019  2018  2019       0.377               185\n5 2019_to_2020  2019  2020       0.175                 9\n6 2020_to_2021  2020  2021       0.571                 9\n7 2021_to_2022  2021  2022       0.317               182\n8 2022_to_2023  2022  2023       0.328               191\n9 2023_to_2024  2023  2024       0.261               199\n```\n\n\n:::\n:::\n\n\n\nAll of these Year-Over-Year correlations (with 2020 results ommitted due to limited sample size) are positive and greater than 0.3, except for 2019 to 2021 (still 0.25). This indicates that the random slopes for the next batter's xwOBA are relatively stable over time, and that pitchers who are more affected by the next batter's xwOBA in one year are likely to be similarly affected in the following year. This implies that the effect of the next batter's xwOBA is not just a product of random noise, but rather a consistent pattern across pitchers.\n\nWe can graph the most recent year pair (2023 to 2024) to visualize the relationship between the random slopes for the next batter's xwOBA in those two years.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Make a graph for the most recent year pair (2023 to 2024)\nre_23_24 <- re_df %>%\n  filter(year %in% c(2023, 2024)) %>%\n  select(pitcher, year, next_batter_xwOBA) %>%\n  pivot_wider(names_from = year, values_from = next_batter_xwOBA, names_prefix = \"xwOBA_\") %>%\n  drop_na()\n\n## Plot\nggplot(re_23_24, aes(x = xwOBA_2023, y = xwOBA_2024)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"blue\") +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"red\") +\n  labs(\n    title = \"Pitcher Susceptibility to Lineup Protection (2023 vs. 2024)\",\n    subtitle = paste0(\"r = \", round(cor(re_23_24$xwOBA_2023, re_23_24$xwOBA_2024), 3)),\n    x = \"Random Slope on next_batter_xwOBA (2023)\",\n    y = \"Random Slope on next_batter_xwOBA (2024)\"\n  ) +\n  theme_pub()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\nNow that we know that these random slopes are stable over time, we will decide to keep them in our model going forward for interpretability.\n\nThis also means that studying indvidual pitcher's susceptibility to lineup protection is a worthwhile endeavor. We can look at the top 10 and bottom 10 pitchers in terms of their random slope for the next batter's xwOBA.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Get 2024 slopes\nslopes_2024 <- re_df %>%\n  filter(year == 2024) %>%\n  select(pitcher, year, next_batter_xwOBA)\n\n## Get top and bottom 10\ntop_10 <- slopes_2024 %>% arrange(desc(next_batter_xwOBA)) %>% slice(1:10)\nbottom_10 <- slopes_2024 %>% arrange(next_batter_xwOBA) %>% slice(1:10)\n\n## Base URL of the data\nbase_url <- \"https://raw.githubusercontent.com/chadwickbureau/register/master/data/\"\n\n## Create vector of suffixes for filenames\nsuffixes <- c(0:9, letters[1:6])\nfile_urls <- paste0(base_url, \"people-\", suffixes, \".csv\")\n\n## Read and combine all files safely, treating all columns as characters\npeople <- map_dfr(file_urls, ~ read_csv(.x, col_types = cols(.default = \"c\")))\n\n## Clean and convert MLBAM ID for joining\npeople_clean <- people %>%\n  select(key_mlbam, name_first, name_last) %>%\n  mutate(key_mlbam = as.integer(key_mlbam))\n\n## Join to top 10 and bottom 10 results\ntop_10 <- top_10 %>%\n  left_join(people_clean, by = c(\"pitcher\" = \"key_mlbam\")) %>%\n  select(name_first, name_last, pitcher, next_batter_xwOBA)\n\nbottom_10 <- bottom_10 %>%\n  left_join(people_clean, by = c(\"pitcher\" = \"key_mlbam\")) %>%\n  select(name_first, name_last, pitcher, next_batter_xwOBA)\n\n## Display\ntop_10\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   name_first name_last pitcher next_batter_xwOBA\n1     Roddery     Muñoz  682610        0.07649964\n2      Martín     Pérez  527048        0.06512998\n3     Taijuan    Walker  592836        0.06485610\n4       Randy   Vásquez  681190        0.05401922\n5     Emerson   Hancock  676106        0.04734642\n6         Jon      Gray  592351        0.04470282\n7     Valente   Bellozo  678368        0.04205315\n8     Anthony    Molina  683627        0.04131252\n9       Kenta     Maeda  628317        0.04045721\n10       Kyle    Gibson  502043        0.03925565\n```\n\n\n:::\n\n```{.r .cell-code}\nbottom_10\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   name_first name_last pitcher next_batter_xwOBA\n1       Tyler   Glasnow  607192       -0.06585163\n2       Mason    Miller  695243       -0.06031694\n3        Paul    Skenes  694973       -0.05088475\n4      Raisel  Iglesias  628452       -0.04973264\n5       Bryan       Woo  693433       -0.04841714\n6      Justin    Steele  657006       -0.04629680\n7         Joe   Jiménez  641729       -0.04529517\n8        Ryan    Walker  676254       -0.04428940\n9        Sean    Hjelle  663546       -0.04105592\n10     Carlos     Rodón  607074       -0.04101263\n```\n\n\n:::\n:::\n\n\n\nIn 2024, the random slopes on next_batter_xwOBA reveal how individual pitchers deviated from the average lineup protection effect—where the fixed effect of next_batter_xwOBA was negative, indicating that pitchers tend to allow lower expected outcomes when a strong hitter is looming. At the top of the slope distribution, pitchers like Roddery Muñoz, Martín Pérez, and Randy Vásquez had positive random slopes, meaning the usual lineup protection suppression effect was less true for them—or even reversed. These pitchers were more susceptible to lineup protection (they allow better results when a stronger batter is on deck).\n\nIn contrast, pitchers like Tyler Glasnow, Paul Skenes, and Bryan Woo had even more negative slopes than average, suggesting they are especially effective at suppressing outcomes when a strong next batter is present. These pitchers were less affected (or may even pitch better) in those scenarios where a stronger batter is on deck.\n\nIt is worth noting that although some of the league's best pitchers (like Glasnow and Skenes) are at the bottom of this list, this does not mean that these lists are simply a ranking of pitcher quality. The random slopes are not correlated with the fixed effect of next_batter_xwOBA, and thus, a pitcher can be very good and still have a high random slope. This is because the random slope is measuring how much the pitcher deviates from the average lineup protection effect, not how good they are overall.\n\nSo, when we see some of the leagues best pitchers at the bottom of this list, it means that one of their skills is to be able to pitch well regardless of the next batter's quality, and potentially even better when there is a threat looming.\n\n**Takeaway:** Some of the league's best pitchers perform better when a strong hitter is on deck, serving as an indication of mental aptitude or ability to elevate in high-leverage moments that makes them so successful. This suggests that lineup protection may not be a universal phenomenon and that individual pitchers may have different responses to it.\n\n#### IB. Drivers of the Overall Offensive Effect\n\nLet's try to uncover where these overall offensive effects are coming from. Since `is_walk`, `is_strikeout`, and `is_extra_base_hit` are binary outcome variables (TRUE/FALSE), we'll want to use logistic regression models. We will use `glm` instead of `glmer` as models including failed to converge within a reasonable amount of time. First, we will look at walks.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_walk <- glm(\n  is_walk ~ batter_bb_pct + next_batter_xwOBA +\n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year,\n  data = pa_data_final,\n  family = binomial(link = \"logit\")\n)\nsummary(m_protection_walk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = is_walk ~ batter_bb_pct + next_batter_xwOBA + current_matchup_advantage + \n    next_matchup_advantage + baserunner_state + outs_when_up + \n    run_diff + game_year, family = binomial(link = \"logit\"), \n    data = pa_data_final)\n\nCoefficients:\n                           Estimate Std. Error z value Pr(>|z|)    \n(Intercept)               -3.604417   0.051621 -69.824  < 2e-16 ***\nbatter_bb_pct             10.764657   0.147696  72.884  < 2e-16 ***\nnext_batter_xwOBA         -0.180966   0.138735  -1.304  0.19210    \ncurrent_matchup_advantage  0.150153   0.010445  14.376  < 2e-16 ***\nnext_matchup_advantage    -0.031530   0.010364  -3.042  0.00235 ** \nbaserunner_state1B        -0.106451   0.014102  -7.549 4.39e-14 ***\nbaserunner_state1B-2B     -0.011978   0.021270  -0.563  0.57332    \nbaserunner_state1B-3B     -0.140937   0.033013  -4.269 1.96e-05 ***\nbaserunner_state2B         0.398295   0.016610  23.979  < 2e-16 ***\nbaserunner_state2B-3B      0.470568   0.030704  15.326  < 2e-16 ***\nbaserunner_state3B         0.354781   0.027459  12.920  < 2e-16 ***\nbaserunner_stateLoaded    -0.241287   0.038858  -6.209 5.32e-10 ***\nouts_when_up               0.089101   0.006316  14.106  < 2e-16 ***\nrun_diff                   0.010447   0.001696   6.160 7.29e-10 ***\ngame_year2016              0.062527   0.020564   3.041  0.00236 ** \ngame_year2017             -0.030562   0.021438  -1.426  0.15399    \ngame_year2018             -0.016728   0.021364  -0.783  0.43362    \ngame_year2019              0.014724   0.022190   0.664  0.50697    \ngame_year2020              0.006981   0.032404   0.215  0.82942    \ngame_year2021              0.016040   0.021642   0.741  0.45860    \ngame_year2022              0.032436   0.021892   1.482  0.13844    \ngame_year2023              0.016310   0.021369   0.763  0.44532    \ngame_year2024             -0.006361   0.022114  -0.288  0.77362    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 300566  on 509603  degrees of freedom\nResidual deviance: 293300  on 509581  degrees of freedom\n  (309808 observations deleted due to missingness)\nAIC: 293346\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\nAs expected, `batter_bb_pct` and `current_matchup_advantage` both have positive and signficant coefficients in our walk model. `m_protection_walk` shows that the coefficient of `next_batter_xwOBA` is negative, but insignificant. This indicates that the next batter's xwOBA does not have a significant impact on the current plate appearance's walk rate. We can do the same for strikeouts:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_strikeout <- glm(\n  is_strikeout ~ batter_k_pct + next_batter_xwOBA +\n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year,\n  data = pa_data_final,\n  family = binomial(link = \"logit\")\n)\nsummary(m_protection_strikeout)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = is_strikeout ~ batter_k_pct + next_batter_xwOBA + \n    current_matchup_advantage + next_matchup_advantage + baserunner_state + \n    outs_when_up + run_diff + game_year, family = binomial(link = \"logit\"), \n    data = pa_data_final)\n\nCoefficients:\n                            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)               -2.7599069  0.0404130 -68.293  < 2e-16 ***\nbatter_k_pct               6.2888199  0.0688935  91.283  < 2e-16 ***\nnext_batter_xwOBA          0.1196696  0.0993374   1.205    0.228    \ncurrent_matchup_advantage -0.0688817  0.0073531  -9.368  < 2e-16 ***\nnext_matchup_advantage    -0.0026393  0.0073570  -0.359    0.720    \nbaserunner_state1B        -0.1499402  0.0097384 -15.397  < 2e-16 ***\nbaserunner_state1B-2B     -0.1076912  0.0150464  -7.157 8.23e-13 ***\nbaserunner_state1B-3B     -0.2957063  0.0235681 -12.547  < 2e-16 ***\nbaserunner_state2B        -0.0984864  0.0134549  -7.320 2.48e-13 ***\nbaserunner_state2B-3B     -0.1337799  0.0261563  -5.115 3.14e-07 ***\nbaserunner_state3B        -0.1344568  0.0226108  -5.947 2.74e-09 ***\nbaserunner_stateLoaded    -0.1370497  0.0254082  -5.394 6.89e-08 ***\nouts_when_up               0.0605834  0.0044796  13.524  < 2e-16 ***\nrun_diff                  -0.0137829  0.0012004 -11.482  < 2e-16 ***\ngame_year2016             -0.0039130  0.0148857  -0.263    0.793    \ngame_year2017              0.0181779  0.0152747   1.190    0.234    \ngame_year2018              0.0179369  0.0152552   1.176    0.240    \ngame_year2019              0.0002611  0.0159714   0.016    0.987    \ngame_year2020              0.0149747  0.0236182   0.634    0.526    \ngame_year2021              0.0241461  0.0154535   1.563    0.118    \ngame_year2022              0.0124838  0.0155830   0.801    0.423    \ngame_year2023              0.0140535  0.0152468   0.922    0.357    \ngame_year2024              0.0224673  0.0154996   1.450    0.147    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 504132  on 509603  degrees of freedom\nResidual deviance: 494273  on 509581  degrees of freedom\n  (309808 observations deleted due to missingness)\nAIC: 494319\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n\nThe coefficient of `next_batter_xwOBA` is positive, but insignificant again. This indicates that the next batter's xwOBA does not have a significant impact on the current plate appearance's strikeout rate.\n\nWe will also look at extra base hits:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_extra_base_hit <- glm(\n  is_extra_base_hit ~ batter_xbh_rate + next_batter_xwOBA +\n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year,\n  data = pa_data_final,\n  family = binomial(link = \"logit\")\n)\nsummary(m_protection_extra_base_hit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = is_extra_base_hit ~ batter_xbh_rate + next_batter_xwOBA + \n    current_matchup_advantage + next_matchup_advantage + baserunner_state + \n    outs_when_up + run_diff + game_year, family = binomial(link = \"logit\"), \n    data = pa_data_final)\n\nCoefficients:\n                           Estimate Std. Error z value Pr(>|z|)    \n(Intercept)               -3.441736   0.040563 -84.848  < 2e-16 ***\nbatter_xbh_rate           13.057888   0.192080  67.981  < 2e-16 ***\nnext_batter_xwOBA         -0.142683   0.108539  -1.315 0.188651    \ncurrent_matchup_advantage  0.135176   0.008168  16.549  < 2e-16 ***\nnext_matchup_advantage    -0.006115   0.008136  -0.752 0.452340    \nbaserunner_state1B         0.017441   0.010602   1.645 0.099965 .  \nbaserunner_state1B-2B      0.006205   0.016541   0.375 0.707566    \nbaserunner_state1B-3B      0.019531   0.024393   0.801 0.423319    \nbaserunner_state2B        -0.097752   0.015498  -6.307 2.84e-10 ***\nbaserunner_state2B-3B     -0.101633   0.029553  -3.439 0.000584 ***\nbaserunner_state3B        -0.048229   0.025613  -1.883 0.059699 .  \nbaserunner_stateLoaded     0.088488   0.026673   3.318 0.000908 ***\nouts_when_up              -0.046111   0.005006  -9.211  < 2e-16 ***\nrun_diff                   0.008150   0.001319   6.180 6.42e-10 ***\ngame_year2016              0.012814   0.016321   0.785 0.432382    \ngame_year2017             -0.010829   0.016705  -0.648 0.516839    \ngame_year2018             -0.005318   0.016873  -0.315 0.752632    \ngame_year2019             -0.007030   0.017236  -0.408 0.683384    \ngame_year2020             -0.011723   0.029103  -0.403 0.687089    \ngame_year2021              0.003950   0.017173   0.230 0.818058    \ngame_year2022              0.011099   0.017279   0.642 0.520644    \ngame_year2023              0.011634   0.016694   0.697 0.485843    \ngame_year2024              0.007072   0.017127   0.413 0.679678    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 477885  on 819411  degrees of freedom\nResidual deviance: 472591  on 819389  degrees of freedom\nAIC: 472637\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\nAgain, the coefficient of `next_batter_xwOBA` is negative, but insignificant.\n\nThese results suggest that the overall offensive effect attributed to lineup protection is not strongly driven by any single offensive outcome. While pitchers may slightly adjust their approach (especially walk likelihood) when facing a strong next batter or easier upcoming matchup, these adjustments do not translate significantly into changes in strikeout, walk, or extra-base hit rates.\n\n**Takeaway:** While we see evidence pointing to fewer walks, more strikeouts, and fewer extra base hits with better `next_batter_xwOBA`, we cannot conclusively point to the next batter's xwOBA as the cause of these effects.\n\n### II. Increased Interpretability: xBA\n\nIn order to increase interpretability, we will also look at the xBA of the current plate appearance. We will use the same model as above, but with `pa_xBA` as our outcome variable instead of `pa_xwOBA`. We will also use the xBA of the current batter as our main independent fixed effect, along with the next batter's strength (as determined by xwOBA). We will also include the batter's handedness matchup, the next batter's handedness matchup, the baserunner state, outs when up, run differential, and game year as fixed effects. We will also include random effects for pitcher and batter.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npa_data_xba <- pa_data_final %>%\n  mutate(pa_xBA = ifelse(is.na(pa_xBA) & pa_xwOBA == 0, 0, pa_xBA)) %>%\n  filter(!is.na(pa_xBA) & !is.na(batter_xBA) & !is.na(next_batter_xBA))\n\nm_protection_xBA <- lmer(\n  pa_xBA ~ batter_xBA + next_batter_xwOBA + \n    current_matchup_advantage + next_matchup_advantage +\n    baserunner_state + outs_when_up + run_diff + game_year +\n    (1 | pitcher),\n  data = pa_data_xba\n)\n\nsummary(m_protection_xBA)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: pa_xBA ~ batter_xBA + next_batter_xwOBA + current_matchup_advantage +  \n    next_matchup_advantage + baserunner_state + outs_when_up +  \n    run_diff + game_year + (1 | pitcher)\n   Data: pa_data_xba\n\nREML criterion at convergence: 276850\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.3726 -0.7915 -0.4387  0.6376  3.0151 \n\nRandom effects:\n Groups   Name        Variance  Std.Dev.\n pitcher  (Intercept) 0.0004604 0.02146 \n Residual             0.0851418 0.29179 \nNumber of obs: 734304, groups:  pitcher, 2347\n\nFixed effects:\n                            Estimate Std. Error         df t value Pr(>|t|)    \n(Intercept)                1.295e-02  4.258e-03  4.365e+05   3.041 0.002361 ** \nbatter_xBA                 9.887e-01  1.317e-02  7.341e+05  75.094  < 2e-16 ***\nnext_batter_xwOBA         -2.290e-02  9.388e-03  7.340e+05  -2.440 0.014706 *  \ncurrent_matchup_advantage  1.205e-02  7.253e-04  5.687e+05  16.610  < 2e-16 ***\nnext_matchup_advantage     4.790e-04  7.274e-04  5.498e+05   0.658 0.510262    \nbaserunner_state1B         5.076e-03  9.161e-04  7.341e+05   5.541 3.01e-08 ***\nbaserunner_state1B-2B      3.190e-03  1.427e-03  7.343e+05   2.235 0.025400 *  \nbaserunner_state1B-3B      1.134e-02  2.107e-03  7.341e+05   5.381 7.41e-08 ***\nbaserunner_state2B        -1.126e-03  1.310e-03  7.341e+05  -0.859 0.390256    \nbaserunner_state2B-3B     -2.789e-03  2.483e-03  7.341e+05  -1.123 0.261369    \nbaserunner_state3B        -2.150e-03  2.193e-03  7.340e+05  -0.981 0.326733    \nbaserunner_stateLoaded     8.590e-03  2.346e-03  7.341e+05   3.662 0.000250 ***\nouts_when_up              -5.730e-03  4.299e-04  7.337e+05 -13.328  < 2e-16 ***\nrun_diff                   4.217e-04  1.153e-04  5.680e+05   3.656 0.000256 ***\ngame_year2016              1.773e-03  1.445e-03  3.783e+05   1.227 0.219947    \ngame_year2017              2.521e-03  1.507e-03  2.408e+05   1.673 0.094291 .  \ngame_year2018              1.790e-03  1.537e-03  1.684e+05   1.165 0.244160    \ngame_year2019              4.417e-03  1.613e-03  1.400e+05   2.738 0.006173 ** \ngame_year2020             -1.605e-03  2.619e-03  3.436e+05  -0.613 0.539805    \ngame_year2021              3.210e-03  1.623e-03  8.141e+04   1.978 0.047935 *  \ngame_year2022              3.134e-03  1.635e-03  6.381e+04   1.917 0.055183 .  \ngame_year2023              4.666e-03  1.624e-03  4.763e+04   2.874 0.004054 ** \ngame_year2024              4.729e-03  1.664e-03  3.673e+04   2.841 0.004498 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCorrelation matrix not shown by default, as p = 23 > 12.\nUse print(x, correlation=TRUE)  or\n    vcov(x)        if you need it\n```\n\n\n:::\n:::\n\n\n\nThis model examines how a plate appearance’s batting average metric (`pa_xBA`) depends on the batter’s season-long average (`batter_xBA`), the following hitter’s season-long expected wOBA (`next_batter_xwOBA`), and various other contextual factors. The large positive coefficient on batter_xBA (\\~0.989) reaffirms that the best predictor of a single PA’s batting outcome is the batter’s own established average. Meanwhile, having a higher `next_batter_xwOBA` (coefficient \\~-0.029) shows a small but statistically significant negative association, indicating the current hitter’s `pa_xBA` may drop a bit when a stronger hitter is on deck. Some baserunner states (e.g., runner on 1B, 1B-2B, or 1B-#B) slightly increase pa_xBA, others (like runner on 2B alone) decrease it, and having more outs also lowers pa_xBA.\n\n**Takeaway:** Even when controlling for batter skill, matchup effects, and game state, a higher next_batter_xwOBA is associated with a small but statistically significant decrease in the current batter’s expected batting average (xBA) for that plate appearance. If the next batter’s xwOBA goes up by 0.100, we estimate a \\~-0.003 reduction in pa_xBA per plate appearance—over 500 plate appearances, that amounts to about 1.5 fewer hits compared to otherwise.\n\n### III. Model Selection of the Overall Offensive Output\n\nLet's return to our `m_protection_slope` model and see if we can improve it with model selection. Using the `drop1` function, which uses F-tests with Satterthwaite’s approximation for degrees of freedom to see what would happen to model fit if we removed each fixed effect one at a time, we get the following results.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrop1(m_protection_slope, test = \"Chisq\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions using Satterthwaite's method:\n\nModel:\npa_xwOBA ~ batter_xwOBA + next_batter_xwOBA + current_matchup_advantage + next_matchup_advantage + baserunner_state + outs_when_up + run_diff + game_year + ((1 | pitcher_year) + (0 + next_batter_xwOBA | pitcher_year))\n                          Sum Sq Mean Sq NumDF  DenDF   F value    Pr(>F)    \nbatter_xwOBA              910.99  910.99     1 622176 6286.5539 < 2.2e-16 ***\nnext_batter_xwOBA           0.81    0.81     1 125767    5.5630   0.01835 *  \ncurrent_matchup_advantage  52.83   52.83     1 370579  364.5597 < 2.2e-16 ***\nnext_matchup_advantage      0.11    0.11     1 332189    0.7769   0.37810    \nbaserunner_state            2.51    0.36     7 621854    2.4699   0.01562 *  \nouts_when_up                7.28    7.28     1 621657   50.2323 1.367e-12 ***\nrun_diff                    0.05    0.05     1 446802    0.3725   0.54165    \ngame_year                   0.65    0.07     9   2584    0.5008   0.87484    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\nAs expected, `batter_xwOBA` is incredibly important to the model, along with `current_matchup_advantage`. `next_batter_xwOBA`, `outs_when_up`, and `baserunner_state` are also important, while `next_matchip_advantage`, `run_diff`, and `game_year` are not.\n\nLet's create a final model with just the most important fixed effects. We will also include the random slope for the next batter's xwOBA.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_protection_final <- lmer(\n  pa_xwOBA ~ batter_xwOBA + next_batter_xwOBA +\n    current_matchup_advantage + \n    baserunner_state + outs_when_up +\n    (1 + next_batter_xwOBA || pitcher_year),  # uncorrelated random effects\n  data = pa_filtered\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\nModel failed to converge with max|grad| = 0.00623311 (tol = 0.002, component 1)\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(m_protection_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: \npa_xwOBA ~ batter_xwOBA + next_batter_xwOBA + current_matchup_advantage +  \n    baserunner_state + outs_when_up + (1 + next_batter_xwOBA ||  \n    pitcher_year)\n   Data: pa_filtered\n\nREML criterion at convergence: 565887.3\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.3680 -0.7696 -0.3876  0.7056  4.7366 \n\nRandom effects:\n Groups         Name              Variance  Std.Dev.\n pitcher_year   (Intercept)       0.0003593 0.01896 \n pitcher_year.1 next_batter_xwOBA 0.0028778 0.05365 \n Residual                         0.1449103 0.38067 \nNumber of obs: 622199, groups:  pitcher_year, 2876\n\nFixed effects:\n                            Estimate Std. Error         df t value Pr(>|t|)    \n(Intercept)                8.100e-05  5.440e-03  2.220e+05   0.015 0.988120    \nbatter_xwOBA               1.018e+00  1.280e-02  6.188e+05  79.544  < 2e-16 ***\nnext_batter_xwOBA         -3.083e-02  1.333e-02  1.332e+05  -2.313 0.020733 *  \ncurrent_matchup_advantage  1.921e-02  9.856e-04  5.109e+05  19.487  < 2e-16 ***\nbaserunner_state1B         1.540e-03  1.304e-03  6.220e+05   1.181 0.237718    \nbaserunner_state1B-2B      9.825e-04  2.077e-03  6.222e+05   0.473 0.636239    \nbaserunner_state1B-3B      2.766e-03  3.079e-03  6.221e+05   0.899 0.368883    \nbaserunner_state2B         6.140e-03  1.842e-03  6.221e+05   3.334 0.000857 ***\nbaserunner_state2B-3B     -1.358e-03  3.558e-03  6.221e+05  -0.382 0.702700    \nbaserunner_state3B         7.146e-03  3.084e-03  6.221e+05   2.317 0.020524 *  \nbaserunner_stateLoaded    -2.701e-03  3.592e-03  6.218e+05  -0.752 0.452108    \nouts_when_up              -4.307e-03  6.086e-04  6.216e+05  -7.077 1.47e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) bt_OBA n__OBA crrn__ bsr_1B b_1B-2 b_1B-3 bsr_2B b_2B-3\nbattr_xwOBA -0.569                                                        \nnxt_btt_OBA -0.607 -0.253                                                 \ncrrnt_mtch_ -0.122  0.035 -0.004                                          \nbsrnnr_st1B -0.026 -0.019  0.007  0.005                                   \nbsrnn_1B-2B -0.019 -0.009  0.015  0.010  0.160                            \nbsrnn_1B-3B -0.009 -0.005  0.007  0.009  0.109  0.074                     \nbsrnnr_st2B -0.009 -0.008  0.001  0.005  0.180  0.120  0.082              \nbsrnn_2B-3B -0.013  0.006  0.003  0.009  0.095  0.064  0.044  0.072       \nbsrnnr_st3B  0.005 -0.004 -0.002  0.006  0.113  0.077  0.054  0.088  0.047\nbsrnnr_sttL -0.016  0.004  0.008  0.011  0.094  0.064  0.044  0.071  0.039\nouts_when_p -0.211 -0.007  0.015  0.006 -0.107 -0.115 -0.089 -0.131 -0.078\n            bsr_3B bsrn_L\nbattr_xwOBA              \nnxt_btt_OBA              \ncrrnt_mtch_              \nbsrnnr_st1B              \nbsrnn_1B-2B              \nbsrnn_1B-3B              \nbsrnnr_st2B              \nbsrnn_2B-3B              \nbsrnnr_st3B              \nbsrnnr_sttL  0.046       \nouts_when_p -0.126 -0.077\noptimizer (nloptwrap) convergence code: 0 (OK)\nModel failed to converge with max|grad| = 0.00623311 (tol = 0.002, component 1)\n```\n\n\n:::\n:::\n\n\n\nIn our final model, all coefficients, except for the different levels of `baserunner_state`, are significant. The coefficient of `next_batter_xwOBA` is -0.03083, and is signficant at the $\\alpha$ = 0.05 level, with a p-value of 0.02. This indicates that the next batter's xwOBA does have a small but significant impact on the current plate appearance's xwOBA, and this effect is negative.\n\n**Takeaway:** When we select certain fixed effects, we find that the next batter's xwOBA continue to have a small but significant impact on the current plate appearance's xwOBA, and this effect is negative. A stronger on-deck hitter results in lower than expected outcomes for that plate appearance.\n\n## Discussion\n\nThis study, although rather simple, tackles some of the problems with sabermetrics' view of lineup protection. By accounting for different game situations, we find that the skill of the next batter does have a statistically significant impact on the offensive outcomes of the current one. While small, this will have significant implications for player evaluation and valuation, as we are establishing dependencies between players that have not been accounted for in the past. We also importantly incorporate the current baserunner situation, number of outs, and current batter handedness advantages, which proved signficant. These all point to the idea that simulations of baseball lineups should both include game situation states and the next batter's skill in order to get a more accurate picture of the current batter's expected outcomes. Each batter does not come up as an indepdent entity with a unique and stationary probability distribution of their outcomes, but rather a probability distribution slightly altered by externalities.\n\n## References\n\nAmbrosino, D. (2011, November 30). *Orders of protection*. The Hardball Times. <https://tht.fangraphs.com/orders-of-protection/>\n\nBradbury, J. C., & Drinen, D. J. (2007). Pigou at the plate. *Journal of Sports Economics*, *9*(2), 211-224. <https://doi.org/10.1177/1527002507300178>\n\nBritton, T. (2024, April 26). J.D. Martinez will be Pete Alonso’s protection in Mets lineup. Does that matter? *The New York Times*. <https://www.nytimes.com/athletic/5443604/2024/04/26/mets-pete-alonso-jd-martinez-lineup/>\n\nCameron, D. (2012, May 25). *Cameron: McCutchen disproves lineup protection*. ESPN.com. <https://insider.espn.com/mlb/insider/story/_/id/7970598/andrew-mccutchen-another-example-why-lineup-protection-myth-mlb>\n\nHow to quantify lineup protection in baseball — The Paraball notes. (2024, April 9). *The Paraball Notes*. <https://www.paraballnotes.com/blog/how-to-quantify-lineup-protection-in-baseball>\n\nLaurila, D. (2016, July 14). *Player’s view: Does lineup protection exist?* FanGraphs Baseball. <https://blogs.fangraphs.com/players-view-does-lineup-protection-exist/>\n\nPetriello, M. (2015, April 13). *Billy Hamilton’s reverse lineup protection*. FanGraphs Baseball. <https://blogs.fangraphs.com/billy-hamiltons-reverse-lineup-protection/>\n\nPhillips, D. C. (2011). You're hurting my game: Lineup protection and injuries in Major League Baseball. *Journal of Quantitative Analysis in Sports*, *7*(3). <https://doi.org/10.2202/1559-0410.1296>\n\nStavenhagen, C. (2019, May 7). The (latest) numbers behind Miguel Cabrera’s remarks on lineup protection. *The New York Times*. <https://www.nytimes.com/athletic/965467/2019/05/07/the-latest-numbers-behind-miguel-cabreras-remarks-on-lineup-protection/>\n\nTango, T. (2006, April 7). *Pitching around batters*. The Hardball Times. <https://tht.fangraphs.com/pitching-around-batters/>\n\nWeinberg, N. (2013, January 1). *Lineup protection: Fact or fiction?* New English D. <https://newenglishd.com/2013/01/01/lineup-protection-fact-or-fiction/>\n\nWiser, J. (2014, February 19). *Let’s talk about lineup protection*. Inside the 'Zona. <https://insidethezona.com/2014/02/lets-talk-lineup-protection/>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}