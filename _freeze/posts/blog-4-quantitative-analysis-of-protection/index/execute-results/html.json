{
  "hash": "64512cb1add4383878a01fb6ffc1243d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Blog Post #4: Quantitative Analysis of Protection\"\nauthor: \"Lance Brady\"\ndate: \"2025-04-16\"\ncategories: [analysis, lineups, statcast]\nformat: html\neditor: visual\nimage: blog4.jpg\nexecute:\n  eval: false\n---\n\n\n\n## Takeaways\n\n## Introduction\n\n## Aim\n\n## Setup\n\n## Methods\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Get the data used in the model (complete cases only)\nmodel_data <- model.frame(m_protection_final)\n\n# 2. Add row index to identify the rows kept\nmodel_data_indexed <- model_data %>%\n  mutate(row_id = row_number())\n\n# 3. Add row ID to pa_filtered\npa_filtered_indexed <- pa_filtered %>%\n  mutate(row_id = row_number())\n\n# 4. Inner join to bring back the full columns for the model-kept rows\npa_with_model_preds <- pa_filtered_indexed %>%\n  semi_join(model_data_indexed, by = c(\"pa_xwOBA\", \"batter_xwOBA\", \"next_batter_xwOBA\",\n                                       \"current_matchup_advantage\", \"baserunner_state\",\n                                       \"outs_when_up\", \"pitcher_year\")) %>%\n  mutate(model_xwOBA = predict(m_protection_final, newdata = ., re.form = NA))\n\n# Summarize to get player-year averages\nbatter_year_model_preds <- pa_with_model_preds %>%\n  group_by(batter, game_year) %>%\n  summarize(\n    model_based_xwOBA = mean(model_xwOBA, na.rm = TRUE),\n    plate_appearances = n(),\n    .groups = \"drop\"\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbatter_stats_all = batter_stats_all %>%\n  mutate(batter_id = factor(batter_id), game_year = factor(game_year))\n\nbatter_comparison <- batter_year_model_preds %>%\n  left_join(\n    batter_stats_all,\n    by = c(\"batter\" = \"batter_id\", \"game_year\")\n  ) %>%\n  filter(plate_appearances >= 200) %>%\n  mutate(xwOBA_diff = model_based_xwOBA - batter_xwOBA)\n```\n:::\n\n\n\n## Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gt)\n\n# Top 10 by raw xwOBA\ntop10_raw <- batter_comparison %>%\n  filter(game_year == 2024) %>%\n  arrange(desc(batter_xwOBA)) %>%\n  slice_head(n = 10) %>%\n  select(batter_raw = batter, raw_xwOBA = batter_xwOBA)\n\n# Top 10 by model-based xwOBA\ntop10_model <- batter_comparison %>%\n  filter(game_year == 2024) %>%\n  arrange(desc(model_based_xwOBA)) %>%\n  slice_head(n = 10) %>%\n  select(batter_model = batter, model_xwOBA = model_based_xwOBA)\n\n# Combine side by side\ntop10_side_by_side <- bind_cols(top10_raw, top10_model)\n\n# Format nicely with gt\ntop10_side_by_side %>%\n  gt() %>%\n  tab_header(title = \"Top 10 Hitters in 2024: Raw vs Model-Based xwOBA\") %>%\n  cols_label(\n    batter_raw = \"Player ID (Raw xwOBA)\",\n    raw_xwOBA = \"Raw xwOBA\",\n    batter_model = \"Player ID (Model xwOBA)\",\n    model_xwOBA = \"Model xwOBA\"\n  ) %>%\n  fmt_number(columns = c(raw_xwOBA, model_xwOBA), decimals = 3)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(batter_comparison, aes(x = batter_xwOBA, y = model_based_xwOBA)) +\n  geom_point(alpha = 0.5) +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"red\") +\n  labs(\n    title = \"Raw xwOBA vs. Model-Based xwOBA by Batter-Year\",\n    x = \"Raw xwOBA\",\n    y = \"Model-Based xwOBA\"\n  ) +\n  theme_minimal()\n```\n:::\n\n\n\n\n\n## Visualizations\n\n## Discussion\n\n## References\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}